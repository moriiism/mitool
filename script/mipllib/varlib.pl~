#!/usr/bin/perl

#
# varlib
#

use strict;
use warnings;
use Cwd;
use File::Basename;
use File::Temp;
use File::Spec;
use POSIX;
use Getopt::Long;
no warnings qw(once);

$ENV{'LANG'} = "C";

our $mxsoft_bin_dir = "";
our $headas_bin_dir = "";
our $leapsecfile = "";
our $syspfiles = "";
our $mxpfiles = "";
our $obsjud_dname = "";
our $mxkwtool_bin_dir = "";
our $mxkwtool_script_dir = "";
our $lockfile_dir = "";
our $runfile_dir = "";
our $xspec_rc = "";
our $gti_mjd_list = "";

our $attlist = "";
our $dptclist = "";
our $orbitlist = "";
our $sarjfnamelist = "";
our $pmfnamelist = "";
our $gscfrcfile_a = "";
our $gscfrcfile_b = "";
our $iss_attlist = "";

our $sleep_time = "";
our $ret_normal = "";
our $ret_error = "";
our $mxobs_mjd_st = "";
our $mxobs_mjd_ed = "";

our %sevar = ();
our %seinvar = ();

&SetVar();
&InitSeVar();
&InitSeInVar();

sub PrintEnv
{
    my $func_name = "mxkwpllib::PrintEnv";
    printf("%s: PATH             = %s\n", $func_name, $ENV{'PATH'});
    printf("%s: LD_LIBRARY_PATH  = %s\n", $func_name, $ENV{'LD_LIBRARY_PATH'});
    printf("%s: PYTHONPATH       = %s\n", $func_name, $ENV{'PYTHONPATH'});
    printf("%s: HEADAS           = %s\n", $func_name, $ENV{'HEADAS'}); 
    printf("%s: ROOTSYS          = %s\n", $func_name, $ENV{'ROOTSYS'});
    printf("%s: MXSOFT           = %s\n", $func_name, $ENV{'MXSOFT'});
    printf("%s: MXDATA           = %s\n", $func_name, $ENV{'MXDATA'});
    printf("%s: CALDB            = %s\n", $func_name, $ENV{'CALDB'});
    printf("%s: CALDBCONFIG      = %s\n", $func_name, $ENV{'CALDBCONFIG'});
    printf("%s: CALDBALIAS       = %s\n", $func_name, $ENV{'CALDBALIAS'});
    printf("%s: GSCRMFDB         = %s\n", $func_name, $ENV{'GSCRMFDB'});
    printf("%s: PGPLOT_TYPE      = %s\n", $func_name, $ENV{'PGPLOT_TYPE'});
    printf("%s: PFILES           = %s\n", $func_name, $ENV{'PFILES'});
    printf("%s: OBSJUD_VER       = %s\n", $func_name, $ENV{'OBSJUD_VER'});

    printf("%s: MXKWTOOL         = %s\n", $func_name, $ENV{'MXKWTOOL'});
    printf("%s: MXKW_GRBTOOL_CAT = %s\n", $func_name, $ENV{'MXKW_GRBTOOL_CAT'});
    printf("%s: MXKW_TMPDIR      = %s\n", $func_name, $ENV{'MXKW_TMPDIR'});
    printf("%s: MXKW_BUSY_DIR    = %s\n", $func_name, $ENV{'MXKW_BUSY_DIR'});
    printf("%s: MXKW_BUSY_FLAG   = %s\n", $func_name, $ENV{'MXKW_BUSY_FLAG'});
}

sub SetVar
{
    $mxsoft_bin_dir         = $ENV{'MXSOFT'} . "/bin";
    $headas_bin_dir         = $ENV{'HEADAS'} . "/bin";
    $leapsecfile            = $ENV{'HEADAS'} . "/refdata/leapsec.fits";
    $syspfiles              = $ENV{'HEADAS'} . "/syspfiles";
    $mxpfiles               = $ENV{'MXSOFT'} . "/pfiles";
    $obsjud_dname           = $ENV{'MXSOFT'} . "/obsjud/" . $ENV{'OBSJUD_VER'} . "/maxi";
    $mxkwtool_bin_dir       = $ENV{'MXKWTOOL'} . "/bin";
    $mxkwtool_script_dir    = $ENV{'MXKWTOOL'} . "/script";
    $lockfile_dir           = $ENV{'MXKW_BUSY_DIR'} . "/lockfile";
    $runfile_dir            = $ENV{'MXKW_TMPDIR'} . "/mxkw_run";
    $xspec_rc               = $ENV{'MXKWTOOL'} . "/script/xspec/xspec.rc";
    $gti_mjd_list           = $ENV{'MXKWTOOL'} . "/script/maxi/data/gti_nobad_gsc3_ads.list";

    $attlist                = $ENV{'MXDATA'} . "/auxil/attlist.fits";
    $dptclist               = $ENV{'MXDATA'} . "/auxil/dptclist.fits";
    $orbitlist              = $ENV{'MXDATA'} . "/auxil/orblist.fits";
    $sarjfnamelist          = $ENV{'MXDATA'} . "/auxil/issancsarj.fits";
    $pmfnamelist            = $ENV{'MXDATA'} . "/auxil/issancpm.fits";
    $gscfrcfile_a           = $ENV{'MXDATA'} . "/auxil/geafrclist.fits";
    $gscfrcfile_b           = $ENV{'MXDATA'} . "/auxil/gebfrclist.fits";
    $iss_attlist            = $ENV{'MXDATA'} . "/issatt/issattlist.fits";

    $sleep_time = 60; # sleep 1 min.
    $ret_normal =  0;
    $ret_error  = -1;
    $mxobs_mjd_st = 55058; #  =2009/Aug/15, Mihara et al. (2011), PASJ, 63, S623
    $mxobs_mjd_ed = 99999;
}

sub PrintVar
{
    my $func_name = "mxkwpllib::PrintVar";

    printf("%s: mxsoft_bin_dir        = %s\n", $func_name, $mxsoft_bin_dir);
    printf("%s: headas_bin_dir        = %s\n", $func_name, $headas_bin_dir);
    printf("%s: leapsecfile           = %s\n", $func_name, $leapsecfile);
    printf("%s: syspfiles             = %s\n", $func_name, $syspfiles);
    printf("%s: mxpfiles              = %s\n", $func_name, $mxpfiles);
    printf("%s: obsjud_dname          = %s\n", $func_name, $obsjud_dname);
    printf("%s: mxkwtool_bin_dir      = %s\n", $func_name, $mxkwtool_bin_dir);
    printf("%s: mxkwtool_script_dir   = %s\n", $func_name, $mxkwtool_script_dir);
    printf("%s: lockfile_dir          = %s\n", $func_name, $lockfile_dir);
    printf("%s: xspec_rc              = %s\n", $func_name, $xspec_rc);
    printf("%s: gti_mjd_list          = %s\n", $func_name, $gti_mjd_list);

    printf("%s: attlist               = %s\n", $func_name, $attlist);
    printf("%s: dptclist              = %s\n", $func_name, $dptclist);
    printf("%s: orbitlist             = %s\n", $func_name, $orbitlist);
    printf("%s: sarjfnamelist         = %s\n", $func_name, $sarjfnamelist);
    printf("%s: pmfnamelist           = %s\n", $func_name, $pmfnamelist);
    printf("%s: gscfrcfile_a          = %s\n", $func_name, $gscfrcfile_a);
    printf("%s: gscfrcfile_b          = %s\n", $func_name, $gscfrcfile_b);
    printf("%s: iss_attlist           = %s\n", $func_name, $iss_attlist);

    printf("%s: sleep_time            = %s\n", $func_name, $sleep_time);
    printf("%s: ret_normal            = %s\n", $func_name, $ret_normal);
    printf("%s: ret_error             = %s\n", $func_name, $ret_error);
    printf("%s: mxobs_mjd_st          = %d\n", $func_name, $mxobs_mjd_st);
    printf("%s: mxobs_mjd_ed          = %d\n", $func_name, $mxobs_mjd_ed);
}


#
# init session variables
#
sub InitSeVar
{
    $sevar{'help'}        = 0;
    $sevar{'verbose'}     = 0;
    $sevar{'debug'}       = 0;
    $sevar{'pfiles_dir'}  = "auto";      # auto or fullpath dir
    $sevar{'xselect_dir'} = "auto";      # auto or fullpath dir
    $sevar{'dptclist'}    = "auto";      # auto, "DEF" or fullpath
    $sevar{'attlist'}     = "auto";      # auto, "DEF" or fullpath
    $sevar{'iss_attlist'} = "auto";      # auto, "DEF" or fullpath
    $sevar{'orblist'}     = "auto";      # auto, "DEF" or fullpath
    $sevar{'outflag'}     = "overwrite"; # overwrite, skip, die
    $sevar{'procdir'}     = ".";         # relpath or fullpath
    $sevar{'progname'}    = "";
}

sub PrintSeVar
{
    my $prompt_sevar = "session_variable";
    printf("%s: help        = %s\n", $prompt_sevar, $sevar{'help'});
    printf("%s: verbose     = %s\n", $prompt_sevar, $sevar{'verbose'});
    printf("%s: debug       = %s\n", $prompt_sevar, $sevar{'debug'});
    printf("%s: pfiles_dir  = %s\n", $prompt_sevar, $sevar{'pfiles_dir'});
    printf("%s: xselect_dir = %s\n", $prompt_sevar, $sevar{'xselect_dir'});
    printf("%s: dptclist    = %s\n", $prompt_sevar, $sevar{'dptclist'});
    printf("%s: attlist     = %s\n", $prompt_sevar, $sevar{'attlist'});
    printf("%s: iss_attlist = %s\n", $prompt_sevar, $sevar{'iss_attlist'});
    printf("%s: orblist     = %s\n", $prompt_sevar, $sevar{'orblist'});
    printf("%s: outflag     = %s\n", $prompt_sevar, $sevar{'outflag'});
    printf("%s: procdir     = %s\n", $prompt_sevar, $sevar{'procdir'});
    printf("%s: progname    = %s\n", $prompt_sevar, $sevar{'progname'});
}

#
# session internal variables
#
sub InitSeInVar
{
    $seinvar{'pfiles_dir'}  = ""; # fullpath dir
    $seinvar{'xselect_dir'} = ""; # fullpath dir
    $seinvar{'dptclist'}    = ""; # "DEF" or fullpath
    $seinvar{'attlist'}     = ""; # "DEF" or fullpath
    $seinvar{'iss_attlist'} = ""; # "DEF" or fullpath
    $seinvar{'orblist'}     = ""; # "DEF" or fullpath
    $seinvar{'lockfile'}    = "";
    $seinvar{'runfile'}     = ""; # If this file does not exist, the current process will stop.
}

sub PrintSeInVar
{
    my $prompt_seinvar = "session_internal_variable";
    printf("%s: pfiles_dir  = %s\n", $prompt_seinvar, $seinvar{'pfiles_dir'});
    printf("%s: xselect_dir = %s\n", $prompt_seinvar, $seinvar{'xselect_dir'});
    printf("%s: dptclist    = %s\n", $prompt_seinvar, $seinvar{'dptclist'});
    printf("%s: attlist     = %s\n", $prompt_seinvar, $seinvar{'attlist'});
    printf("%s: iss_attlist = %s\n", $prompt_seinvar, $seinvar{'iss_attlist'});
    printf("%s: orblist     = %s\n", $prompt_seinvar, $seinvar{'orblist'});
    printf("%s: lockfile    = %s\n", $prompt_seinvar, $seinvar{'lockfile'});
    printf("%s: runfile     = %s\n", $prompt_seinvar, $seinvar{'runfile'});

}


1;
